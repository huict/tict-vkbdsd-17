<!DOCTYPE html>
<html lang="du">
<head>
<meta charset="utf-8"/>
<title>Big Data System Design</title>
<meta name="author" content="((link (:type mailto :path roelant.ossewaarde@hu.nl :format bracket :raw-link mailto:roelant.ossewaarde@hu.nl :application nil :search-option nil :begin 1 :end 57 :contents-begin 36 :contents-end 54 :post-blank 1 :parent #0) Roelant Ossewaarde) en  (link (:type mailto :path jos.vanreenen@hu.nl :format bracket :raw-link mailto:jos.vanreenen@hu.nl :application nil :search-option nil :begin 60 :end 106 :contents-begin 90 :contents-end 104 :post-blank 0 :parent #0) Jos van Reenen) , B 2019-2020)"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./reveal.js/css/reveal.css"/>

<link rel="stylesheet" href="./reveal.js/css/theme/simple.css" id="theme"/>

<link rel="stylesheet" href="./personalization.css"/>

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = './reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide" data-background="images/huhl15.jpg"><h1>Big Data System Design</h1><h3>Casus: actuele systemen</h3><p><small><a href="mailto:roelant.ossewaarde@hu.nl">Roelant Ossewaarde</a> en <a href="mailto:jos.vanreenen@hu.nl">Jos van Reenen</a>, B 2019-2020</small></p>
</section>

<section>
<section id="slide-org1e6dcb4">
<h2 id="org1e6dcb4"><span class="section-number-2">1</span> Map-reduce</h2>
<p>
Multi-core computers kunnen efficiënt processen in parallel
afwerken. Ze moeten dan wel op de juiste manier aangestuurd
worden. Eén van de toepassingen is <b>data-intensive scalabale computing
(DISC)</b>: het verwerken van grote datasets. Google ontwikkelde een
belangrijk algoritme: MapReduce. Yahoo ontwikkelde een architectuur
(<a href="https://hadoop.apache.org/">Hadoop</a>) waarin MapReduce efficiënt geïmplementeerd kan worden.
</p>

</section>
<section id="slide-orgee316b8">
<h3 id="orgee316b8"><span class="section-number-3">1.1</span> Map / Reduce komt uit de wereld van Functional Programming</h3>
<p>
Voorbeeld-code van for-loop vs map (in Rust):
</p>

<pre><code class="rust" data-noescape>
fn multiply_with_for_loop(input_numbers : &Vec<i32>) {
    // vermenig alle elementen met een constante factor met een for-loop
    let mut output_numbers = vec![0,0,0,0,0];
    for i in 0..input_numbers.len() {
      <mark>output_numbers[i] = input_numbers[i] * 10;</mark>
    }
    println!("Output met for-loop: {:?}", output_numbers);
    // verwachtte output: Output met for-loop: [10, 20, 30, 40, 50]
}
</code></pre>

<pre><code class="rust" data-noescape>
fn multiply_with_map(input_numbers : &Vec<i32>) {
    let input_numbers_iterator = input_numbers.iter();
    let output_numbers :Vec<i32> = input_numbers_iterator.map(|i| i*10).collect();
    println!("Output met map-loop: {:?}", output_numbers);
    // verwachtte output: Output met map-loop: [10, 20, 30, 40, 50]
}

</section>
<section id="slide-orgfae52a5">
<h3 id="orgfae52a5"><span class="section-number-3">1.2</span> Map / Reduce komt uit de wereld van Functional Programming</h3>
<p>
Voorbeeld-code van for-loop vs reduce (in Rust):
</p>

<pre><code class="rust" data-noescape>
fn sum_with_for_loop (input_numbers : &Vec<i32>) {
    let mut output_sum = 0;
    for i in 0..input_numbers.len() {
<mark>	output_sum = output_sum + input_numbers[i];</mark>
    }
    println!("Output sum met for-loop: {:?}", output_sum);
    // verwachtte output: Output sum met for-loop: 15
    }

fn sum_with_reduce (input_numbers : &Vec<i32>) {
    let input_numbers_iterator = input_numbers.iter();
<mark>    let output_sum : i32 = input_numbers_iterator.sum();</mark>
    println!("Output sum met reduce: {:?}", output_sum);
    // verwachtte output: Output sum met reduce: 15
}

</code></pre>



</section>
<section id="slide-org366b63e">
<h3 id="org366b63e"><span class="section-number-3">1.3</span> Architectuur van een MapReduce implementatie</h3>

<div class="figure">
<p><img src="./images/mapreduce1.png" alt="mapreduce1.png" />
</p>
</div>

</section>
<section id="slide-org648367a" class="p-smaller">
<h3 id="org648367a"><span class="section-number-3">1.4</span> Workflow voorbeeld van Word Count</h3>

<div class="figure">
<p><img src="./images/mapreduce-workflow.png" alt="mapreduce-workflow.png" />
</p>
</div>

<p>
(bron: <a href="https://dzone.com/articles/word-count-hello-word-program-in-mapreduce">https://dzone.com/articles/word-count-hello-word-program-in-mapreduce</a>)
</p>

</section>
<section id="slide-orgab8514f">
<h3 id="orgab8514f"><span class="section-number-3">1.5</span> Voorbeeld-run van een word count mapper</h3>
<p>
Zie <a href="https://github.com/roelanto/tcifbigdata">https://github.com/roelanto/tcifbigdata</a> voor een voorbeeldimplementatie met werkende code. 
</p>

<p>
Mapper: <i>emit</i> een 1 voor ieder woord dat gevonden wordt. 
</p>

<div class="org-src-container">

<pre  class="src src-java"><code trim><span style="color: #a020f0;">class</span> <span style="color: #228b22;">WordCountMapper</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">Mapper</span>&lt;<span style="color: #228b22;">LongWritable</span>, <span style="color: #228b22;">Text</span>, <span style="color: #228b22;">Text</span>, <span style="color: #228b22;">IntWritable</span>&gt; {

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">map</span>(<span style="color: #228b22;">LongWritable</span> <span style="color: #a0522d;">Key</span>,
                    <span style="color: #228b22;">Text</span> <span style="color: #a0522d;">value</span>,
                    <span style="color: #228b22;">Context</span> <span style="color: #a0522d;">context</span>) <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">IOException</span>, <span style="color: #228b22;">InterruptedException</span> {
        <span style="color: #228b22;">String</span>[] <span style="color: #a0522d;">tokens</span> = value.toString().split(<span style="color: #8b2252;">"\\s"</span>);
        <span style="color: #a020f0;">for</span> (<span style="color: #228b22;">String</span> <span style="color: #a0522d;">s</span> : tokens) {
            context.write(<span style="color: #a020f0;">new</span> <span style="color: #228b22;">Text</span>(s), <span style="color: #a020f0;">new</span> <span style="color: #228b22;">IntWritable</span>(1));
        }
    }
}
</code></pre>
</div>

</section>
<section id="slide-org6339092">
<h3 id="org6339092"><span class="section-number-3">1.6</span> Voorbeeld-run van een word count reducer</h3>
<p>
Reducer: <i>emit</i> de som van alle gevonden '1'-en.
</p>

<div class="org-src-container">

<pre  class="src src-java"><code trim><span style="color: #a020f0;">class</span> <span style="color: #228b22;">WordCountReducer</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">Reducer</span>&lt;<span style="color: #228b22;">Text</span>, <span style="color: #228b22;">IntWritable</span>, <span style="color: #228b22;">Text</span>, <span style="color: #228b22;">IntWritable</span>&gt; {
        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">reduce</span>(<span style="color: #228b22;">Text</span> <span style="color: #a0522d;">key</span>,
                           <span style="color: #228b22;">Iterable</span>&lt;<span style="color: #228b22;">IntWritable</span>&gt; <span style="color: #a0522d;">values</span>,
                           <span style="color: #228b22;">Context</span> <span style="color: #a0522d;">context</span>) <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">IOException</span>, <span style="color: #228b22;">InterruptedException</span> {
                <span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span> = 0;
                <span style="color: #a020f0;">for</span> (<span style="color: #228b22;">IntWritable</span> <span style="color: #a0522d;">i</span> : values) {
                        sum += i.get();
                }
                context.write(key, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">IntWritable</span>(sum));
        }
}
</code></pre>
</div>


</section>
</section>
<section>
<section id="slide-orgd215ed6">
<h2 id="orgd215ed6"><span class="section-number-2">2</span> Lambda, Kappa, Kudu</h2>
<div class="outline-text-2" id="text-2">
</div>
</section>
<section id="slide-org6ab166a">
<h3 id="org6ab166a"><span class="section-number-3">2.1</span> OLAP vs OLTP</h3>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">OLTP</th>
<th scope="col" class="org-left">OLAP</th>
</tr>

<tr>
<th scope="col" class="org-left">Characteristics</th>
<th scope="col" class="org-left">Transactional RDBMS</th>
<th scope="col" class="org-left">Data Warehouse</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Data Content</td>
<td class="org-left">Current values</td>
<td class="org-left">Historical, summarized, calculated data</td>
</tr>

<tr>
<td class="org-left">Data Organization</td>
<td class="org-left">Application by application</td>
<td class="org-left">Subject areas across enterprise (departmental)</td>
</tr>

<tr>
<td class="org-left">Nature of Data</td>
<td class="org-left">Dynamic</td>
<td class="org-left">Static until refreshed</td>
</tr>

<tr>
<td class="org-left">Data Structure</td>
<td class="org-left">Normalised ( &gt;= 3NF )</td>
<td class="org-left">Star-schema / Dimensional</td>
</tr>

<tr>
<td class="org-left">Data Manipulation</td>
<td class="org-left">Updated on a field-by-field basis</td>
<td class="org-left">Access only, usually no direct update</td>
</tr>

<tr>
<td class="org-left">Usage</td>
<td class="org-left">Highly structured, repetitive processing (Clerical User)</td>
<td class="org-left">Highly structured, analytical processing (Knowledge User)</td>
</tr>

<tr>
<td class="org-left">Response Time</td>
<td class="org-left">Critical (Sub-Second/seconds)</td>
<td class="org-left">Non-critical (seconds/minutes)</td>
</tr>

<tr>
<td class="org-left">Updates vs. Reports</td>
<td class="org-left">Real-time Updates, Batch Reporting</td>
<td class="org-left">Batch Updates, Real-time Reporting</td>
</tr>
</tbody>
</table>

</section>
<section id="slide-org820c0e1">
<h3 id="org820c0e1"><span class="section-number-3">2.2</span> Lambda architectuur</h3>

<div id="org904d2e6" class="figure">
<p><img src="./images/lambda-architecture2.png" alt="lambda-architecture2.png" width="80%" style="float: right" title="Interleaving of transaction can lead to anomalies." />
</p>
<p><span class="figure-number">Figure 3: </span>Lambda architectuur</p>
</div>

<ol class="org-ol">
<li><a id="org7663f6c"></a>Batch-layer:<br />
<ol>
<li>Master data set. "Immutable": data verandert niet.</li>
<li>Precompute alle "views".</li>
<li>Traditioneel: opgeslagen met HDFS, verwerkt dmv Map/Reduce</li>

</ol>
</li>
</ol>

</section>
<section id="slide-org618f93c">
<h3 id="org618f93c"><span class="section-number-3">2.3</span> Lambda architectuur</h3>

<div id="orga4037bb" class="figure">
<p><img src="./images/lambda-architecture2.png" alt="lambda-architecture2.png" width="80%" style="float: right" title="Interleaving of transaction can lead to anomalies." />
</p>
<p><span class="figure-number">Figure 4: </span>Lambda architectuur</p>
</div>


<ol class="org-ol">
<li><a id="orgdfd6dbf"></a>Speed-layer<br />
<ol>
<li>Streaming data / micro-batches</li>
<li>Traditioneel: Apache Spark en Stormm.</li>

</ol>
</li>
</ol>

</section>
<section id="slide-orgc045436">
<h3 id="orgc045436"><span class="section-number-3">2.4</span> Lambda architectuur</h3>

<div id="org4e45d20" class="figure">
<p><img src="./images/lambda-architecture2.png" alt="lambda-architecture2.png" width="80%" style="float: right" title="Interleaving of transaction can lead to anomalies." />
</p>
<p><span class="figure-number">Figure 5: </span>Lambda architectuur</p>
</div>


<ol class="org-ol">
<li><a id="org17158c0"></a>Serving-layer:<br />
<ol>
<li>Geen "ruwe" data, gebruikt views van batch- en speed-layer.</li>
<li>Bijvoorbeeld een SQL-engine op een traditioneel filesysteem, of HBase of Apache Impala.</li>

</ol>
</li>
</ol>

</section>
<section id="slide-orgc16f037">
<h4 id="orgc16f037"><span class="section-number-4">2.4.1</span> Voordelen van Lambda</h4>
<ol>
<li>Verbinding van verschillende producten, elk met hun unieke sterke kanten.</li>
<li>Schaalbaar via de batch-layer.</li>
<li>Realtime performance via de speed-layer.</li>

</ol>

</section>
<section id="slide-org0dbc788">
<h4 id="org0dbc788"><span class="section-number-4">2.4.2</span> Nadelen van Lambda</h4>
<ol>
<li>Complexiteit:
<ol>
<li>Veel verschillende delen.</li>
<li>Restatement is lastig.</li>
<li>Twee code-bases tegelijk.</li>
<li>Fout-afhandeling is moeilijker, door alle verschillende delen.</li>

</ol></li>

</ol>

</section>
<section id="slide-orgf497aab">
<h3 id="orgf497aab"><span class="section-number-3">2.5</span> Kudu: snelle analytics op snel-veranderende data.</h3>
<ol>
<li>HDFS excels at:
<ul>
<li>Batch ingest only (e.g. hourly)</li>
<li>Efficiently scanning large amounts of data (analytics)</li>

</ul></li>
<li>HBase excels at:
<ul>
<li>Efficiently finding and writing individual rows</li>
<li>Making data mutable</li>

</ul></li>
<li>Gaps exist when these properties are neededsimultaneously</li>

</ol>


<div id="org0d20d3d" class="figure">
<p><img src="./images/kudu-why-second.png" alt="kudu-why-second.png" width="30%" style="float: right" title="Architectuur van Kudu" />
</p>
<p><span class="figure-number">Figure 6: </span>Kudu architectuur</p>
</div>




</section>
<section id="slide-org96fadf7">
<h3 id="org96fadf7"><span class="section-number-3">2.6</span> Kudu: snelle analytics op snel-veranderende data.</h3>
<ol>
<li><b>High throughput</b> for big scans. Goal:Within 2x of Parquet</li>
<li><b>Low-latency</b> for short accesses. Goal: 1ms read/write on SSD</li>
<li>Database-like semantics (initially single-row ACID)•</li>
<li>Relational data model:
<ol>
<li>SQL queries are easy</li>
<li>“NoSQL” style scan/insert/update (Java/C++ client)</li>

</ol></li>

</ol>


<div id="orgc47e4a5" class="figure">
<p><img src="./images/kudu-why-first.png" alt="kudu-why-first.png" width="30%" style="float: right" title="Architectuur van Kudu" />
</p>
<p><span class="figure-number">Figure 7: </span>Kudu architectuur</p>
</div>



<ol>
<li>HDFS excels at:
<ul>
<li>Batch ingest only (e.g. hourly)</li>
<li>Efficiently scanning large amounts of data (analytics)</li>

</ul></li>
<li>HBase excels at:
<ul>
<li>Efficiently finding and writing individual rows</li>
<li>Making data mutable</li>

</ul></li>
<li>Gaps exist when these properties are neededsimultaneously</li>

</ol>


</section>
<section id="slide-org3b67b64">
<h3 id="org3b67b64"><span class="section-number-3">2.7</span> Aspecten van Kudu</h3>
<div class="outline-text-3" id="text-2-7">
</div>
<ol class="org-ol">
<li><a id="org33298cf"></a>Table-oriented storage<br />
<ol>
<li>Table has SQL/RDBMS-like schema
<ol>
<li>Primary key (one or many columns)</li>
<li>NO secondary indexes</li>
<li>Finite number of columns (unlike HBase, Cassandra)</li>
<li>Each column has name and type</li>

</ol></li>
<li>Horizontally partitioned (range, hash) – called tablets. 
<ol>
<li>Tablets typically have 3 or 5 replicas</li>

</ol></li>
<li>CRUD</li>
<li>Integrated with Impala, MapReduce, Spark and counting</li>
<li>Zeer fout-tolerant, door gebruik van <a href="http://thesecretlivesofdata.com/raft/">het RAFT-protocol.</a></li>

</ol>
</li>
</ol>
</section>
</section>
</div>
</div>
<script src="./reveal.js/js/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
slideNumber:true,
width:"80%",
height:"100%",
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
{ src: 'reveal.js/plugin/reveald3.js', async: true }, { src: 'plugin/quiz/js/quiz.js', async: true, callback: function() { prepareQuizzes({}); } }, { src: 'plugin/highlight/highlight.js', async: true },
 { src: './reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
 { src: './reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: './reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: './reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: './reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }]
});
</script>
</body>
</html>
